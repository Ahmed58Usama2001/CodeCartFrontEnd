<div class="container mt-5">
  <mat-card class="login-card">
    <mat-card-header>
      <mat-card-title class="text-center w-100">Welcome Back</mat-card-title>
      <mat-card-subtitle class="text-center w-100">Please login to continue</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="loginForm" (ngSubmit)="submit()" class="login-form">
        <div class="mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Email</mat-label>
            <input
              matInput
              id="email"
              type="email"
              formControlName="email"
              autocomplete="username"
            />
            <mat-icon matSuffix>email</mat-icon>
            <mat-error *ngIf="email?.invalid && email?.touched">
              <span *ngIf="email?.errors?.['required']">Email is required.</span>
              <span *ngIf="email?.errors?.['email']">Enter a valid email.</span>
            </mat-error>
          </mat-form-field>
        </div>

        <div class="mb-4">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Password</mat-label>
            <input
              matInput
              id="password"
              type="password"
              formControlName="password"
              autocomplete="current-password"
            />
            <mat-icon matSuffix>lock</mat-icon>
            <mat-error *ngIf="password?.invalid && password?.touched">
              <span *ngIf="password?.errors?.['required']">Password is required.</span>
              <span *ngIf="password?.errors?.['minlength']">
                Password must be at least 6 characters.
              </span>
            </mat-error>
          </mat-form-field>
        </div>

        <div *ngIf="errorMessage" class="text-danger mb-3 text-center">{{ errorMessage }}</div>

        <button
          mat-raised-button
          color="primary"
          type="submit"
          class="w-100 py-2"
          [disabled]="loading()"
        >
          <span *ngIf="!loading()">Login</span>
          <mat-spinner *ngIf="loading()" diameter="24" class="mx-auto"></mat-spinner>
        </button>
      </form>

      <div class="divider d-flex align-items-center my-4">
        <p class="text-center mx-3 mb-0">OR</p>
      </div>

      <div class="social-login d-flex flex-column gap-2">
        <button
          mat-stroked-button
          (click)="googleSignIn()"
          [disabled]="loading() || !googleLoaded()"
          class="social-btn google"
        >
          <img src="assets/google-icon.svg" alt="Google" class="me-2" width="20" />
          <span *ngIf="googleLoaded(); else googleLoading">Sign in with Google</span>
          <ng-template #googleLoading>Loading Google...</ng-template>
        </button>
        <button
          mat-stroked-button
          (click)="facebookSignIn()"
          [disabled]="loading() || !facebookLoaded()"
          class="social-btn facebook"
        >
          <img src="assets/facebook-icon.svg" alt="Facebook" class="me-2" width="20" />
          <span *ngIf="facebookLoaded(); else facebookLoading">Sign in with Facebook</span>
          <ng-template #facebookLoading>Loading Facebook...</ng-template>
        </button>
      </div>
    </mat-card-content>

    <mat-card-footer class="text-center mt-3">
      <p class="mb-0">
        <a style="cursor:pointer" (click)="navigateToRegister()" class="text-decoration-underline text-primary"
          >Don't have an account? Sign up</a
        >
      </p>
      <a routerLink="/account/forgot-password" class="text-muted small">Forgot password?</a>
    </mat-card-footer>
  </mat-card>
</div>